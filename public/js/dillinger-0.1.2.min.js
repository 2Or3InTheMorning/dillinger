
$(function(){function x(a,b){(function(c,d){var e=c.createElement(d),f=c.getElementsByTagName(d)[0];e.async=1,e.src=a,f.parentNode.insertBefore(e,f),e.onload=function(){b&&b()}})(document,"script")}function y(){var a;try{localStorage.getItem&&(a=localStorage)}catch(b){}return a}function z(){var a;try{a=JSON.parse(localStorage.profile),a=$.extend(!0,j,a)}catch(b){a=j}j=a}function A(a){localStorage.clear(),localStorage.profile=JSON.stringify($.extend(!0,j,a))}function B(a){return D(a,"pfx")}function C(a,b){for(var c in a)if(m[a[c]]!==undefined)return b==="pfx"?a[c]:!0;return!1}function D(a,b){var c=a.charAt(0).toUpperCase()+a.substr(1),d=(a+" "+n.join(c+" ")+c).split(" ");return C(d,b)}function E(){var a={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"msTransitionEnd",transition:"transitionEnd"};return a[B("transition")]}function F(a){return"dillinger_"+(new Date).toISOString().replace(/[\.:-]/g,"_")+"."+a}function G(){y()?($.support.transitionEnd=E(),z(),H(),I(),d=new Showdown.converter,V(),Z(),_(),ba(),bb(),L()):T()}function H(){c=ace.edit("editor"),O(j.theme,function(){c.getSession().setUseWrapMode(!0),c.setShowPrintMargin(!1);var a=require("ace/mode/markdown").Mode;c.getSession().setMode(new a),c.getSession().setValue(j.currentMd||c.getSession().getValue()),Q()})}function I(){q.find('option[value="'+j.theme+'"]').attr("selected",!0),r.css("backgroundImage",j.showPaper?'url("'+i+'")':'url("")'),s.text(j.autosave.enabled?"Disable Autosave":"Enable Autosave"),g=u.attr("data-github-user"),g&&bc.showMessage("What's Up "+g,1e3),f=o.css("right")}function J(){c.getSession().setValue(""),Q()}function K(a){A({currentMd:c.getSession().getValue()}),a&&bc.showMessage(bc.messages.docSavedLocal)}function L(){j.autosave.enabled?e=setInterval(function(){K()},j.autosave.interval):clearInterval(e)}function M(){localStorage.clear(),bc.showMessage(bc.messages.profileCleared,1400)}function N(){var a=q.find("option:selected").val();if(a===j.theme)return;O(a,function(){bc.showMessage(bc.messages.profileUpdated)})}function O(a,b){var d=a.split("/").pop();x("/js/theme-"+d+".js",function(){c.setTheme(a),b&&b(),P(d),A({theme:a})})}function P(a){document.body.style.backgroundColor=w[a]}function Q(){var a=c.getSession().getValue(),b=d.makeHtml(a);r.html("").html(b)}function R(){function b(a,b){}function d(a,b,c){var d=JSON.parse(c.responseText);document.getElementById("downloader").src="/files/md/"+d.data}function e(a,b,c){alert("Roh-roh. Something went wrong. :(")}function f(a,b){}var a=c.getSession().getValue(),g={type:"POST",data:"unmd="+encodeURIComponent(a),dataType:"json",url:"/factory/fetch_markdown",beforeSend:b,error:e,success:d,complete:f};$.ajax(g)}function S(){function b(a,b){}function d(a,b,c){var d=JSON.parse(c.responseText);document.getElementById("downloader").src="/files/html/"+d.data}function e(a,b,c){alert("Roh-roh. Something went wrong. :(")}function f(a,b){}var a=c.getSession().getValue(),g={type:"POST",data:"unmd="+encodeURIComponent(a),dataType:"json",url:"/factory/fetch_html",beforeSend:b,error:e,success:d,complete:f};$.ajax(g)}function T(){alert("Sad Panda - No localStorage for you!")}function U(){$(".modal-header h3").text("What's the deal with Dillinger?");var a="<p>Dillinger is an online cloud-enabled, HTML5, buzzword-filled Markdown editor.</p><p>Dillinger was designed and developed by <a href='http://twitter.com/joemccann'>@joemccann</a> because he needed a decent Markdown editor.</p><p>Dillinger is a 100% open source project so <a href='https://github.com/joemccann/dillinger'>fork the code</a> and contribute!</p><p>Follow Dillinger on Twitter at <a href='http://twitter.com/dillingerapp'>@dillingerapp</a></p>";$(".modal-body").html(a),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function V(){v.bind($.support.transitionEnd,function(a){if($("nav").hasClass("slide_in"))return;t.text(h?"Show Navigation":"Hide Navigation"),p.slideToggle(50,function(){o[h?"addClass":"removeClass"]("opacity_thirty").animate({right:h?"-40px":f},200),h=!h})})}function W(){v.hasClass("slide_in")?v.removeClass("slide_in").addClass("slide_out"):v.removeClass("slide_out").addClass("slide_in")}function X(){r.css("backgroundImage",j.showPaper?'url("")':'url("'+i+'")'),A({showPaper:!j.showPaper}),bc.showMessage(bc.messages.profileUpdated)}function Y(){s.text(j.autosave.enabled?"Enable Autosave":"Disable Autosave"),A({autosave:{enabled:!j.autosave.enabled}}),L()}function Z(){$("#editor").bind("keyup",Q)}function _(){var a={over:function(){if($("nav").hasClass("slide_in"))return;o.removeClass("opacity_thirty").animate({right:f},200)},timeout:300,out:function(){if($("nav").hasClass("slide_in"))return;p.is(":visible")&&p.slideToggle(50),o.animate({right:"-40px"},200).addClass("opacity_thirty")}};$(".core_inner").on("click",function(){p.slideToggle(50)}),o.hoverIntent(a),$("#clear").on("click",function(){return J(),!1}),$("#save").on("click",function(){return j.dropbox.current_filename=j.dropbox.current_filename||"/Dillinger/"+F("md"),be.putMarkdownFile(),K(),!1}),$("#paper").on("click",function(){return X(),!1}),q.on("change",function(){return N(),!1}),t.on("click",function(){return W(),!1}),$("#reset").on("click",function(){return M(),!1}),s.on("click",function(){return Y(),!1}),u.on("click",function(){return bd.fetchRepos(),!1}),$("#dropbox_profile").on("click",function(){return be.searchDropbox(),!1}),$("#export_md").on("click",function(){return R(),!1}),$("#export_html").on("click",function(){return S(),!1}),$("#about").on("click",function(){return U(),!1})}function ba(){key("command+s, ctrl+s",function(a){K(!0),a.preventDefault()});var a={name:"save",bindKey:{mac:"Command-S",win:"Ctrl-S"},exec:function(){K()}}}function bb(){$(document).on("click",".repo",function(){var a=$(this).parent("li").attr("data-repo-name");return bd.isRepoPrivate=$(this).parent("li").attr("data-repo-private")==="true"?!0:!1,bd.fetchBranches(a),!1}).on("click",".branch",function(){var a=$(this).parent("li").attr("data-repo-name"),b=$(this).parent("li").attr("data-commit-sha");return bd.currentBranch=$(this).text(),bd.fetchTreeFiles(a,b),!1}).on("click",".tree_file",function(){var a=$(this).parent("li").attr("data-tree-file");return bd.fetchMarkdownFile(a),!1}).on("click",".dropbox_file",function(){return j.dropbox.current_filename=$(this).parent("li").attr("data-file-path"),be.fetchMarkdownFile(j.dropbox.current_filename),!1})}var c,d,e,f,g,h=!0,i="/img/notebook_paper_200x200.gif",j={theme:"ace/theme/clouds_midnight",showPaper:!0,currentMd:"",autosave:{enabled:!0,interval:3e3},dropbox:{current_filename:null}},k="dillinger",l=document.createElement(k),m=l.style,n="Webkit Moz O ms Khtml".split(" "),o=$(".cont"),p=$(".core_menu"),q=$("#theme"),r=$("#preview"),s=$("#autosave"),t=$("#toggleNav"),u=$("#github_profile"),v=$("nav"),w={clouds:"#7AC9E3",clouds_midnight:"#5F9EA0",cobalt:"#4d586b",crimson_editor:"#ffffff",dawn:"#DADCAD",eclipse:"#6C7B8A",idle_fingers:"#DEB887",kr_theme:"#434343",merbivore:"#3E353E",merbivore_soft:"#565156",mono_industrial:"#C0C0C0",monokai:"#F5DEB3",pastel_on_dark:"#676565","solarized-dark":"#0E4B5A",solarized_light:"#dfcb96",textmate:"#fff",tomorrow:"#0e9211",tomorrow_night:"#333536",tomorrow_night_blue:"#3a4150",tomorrow_night_bright:"#3A3A3A",tomorrow_night_eighties:"#474646",twilight:"#534746",vibrant_ink:"#363636"},bc=function(){var a=$("#notify");return{messages:{profileUpdated:"Profile updated",profileCleared:"Profile cleared",docSavedLocal:"Document saved locally",docSavedServer:"Document saved on our server",docSavedDropbox:"Document saved on dropbox",dropboxImportNeeded:"Please import a file from dropbox first."},showMessage:function(b,c){a.text("").stop().text(b).slideDown(250,function(){a.delay(c||1e3).slideUp(250)})}}}(),bd=function(){function d(c,d){return a=c.url.toLowerCase(),b=d.url.toLowerCase(),a===b?0:isNaN(c)||isNaN(d)?a>b?1:-1:c-d}function e(a){return/(\.md)|(\.markdown)/i.test(a)}function f(a,b){var c=[],d="https://raw.github.com",f="/";return b.forEach(function(b){if(e(b.path)){var h;bd.isRepoPrivate?h=b.url:h=d+f+g+f+a+f+bd.currentBranch+f+b.path;var i={link:h,path:b.path,sha:b.sha};c.push(i)}}),c}function h(a){var b="<ul>";return a.sort(d),a.forEach(function(a){var c=a.url.split("/").pop();b+='<li data-repo-name="'+c+'" data-repo-private="'+a.private+'"><a class="repo" href="#">'+c+"</a></li>"}),b+="</ul>",$(".modal-header h3").text("Your Github Repos"),$(".modal-body").html(b),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}function i(a,b){var c="";b.forEach(function(b){var d=b.name,e=b.commit.sha;c+='<li data-repo-name="'+a+'" data-commit-sha="'+e+'"><a class="branch" href="#">'+d+"</a></li>"}),$(".modal-header h3").text(a),$(".modal-body").find("ul").find("li").remove().end().append(c)}function j(a,b){var c=f(a,b),d="";c.forEach(function(a){d+=bd.isRepoPrivate?'<li data-tree-file-sha="'+a.sha+'" data-tree-file="'+a.link+'" class="private_repo"><a class="tree_file" href="#">'+a.path+"</a></li>":'<li data-tree-file="'+a.link+'"><a class="tree_file" href="#">'+a.path+"</a></li>"}),$(".modal-header h3").text(a),$(".modal-body").find("ul").find("li").remove().end().append(d)}return{currentBranch:"",isRepoPrivate:!1,fetchRepos:function(){function a(a,b){bc.showMessage("Fetching Repos...")}function b(a,b,c){c=JSON.parse(c.responseText),c.length?h(c):bc.showMessage("No repos available!")}function c(a,b,c){alert("Roh-roh. Something went wrong. :(")}function d(a,b){}var e={type:"POST",dataType:"text",url:"/github/repo/fetch_all",beforeSend:a,error:c,success:b,complete:d};$.ajax(e)},fetchBranches:function(a){function b(b,c){bc.showMessage("Fetching Branches for Repo "+a)}function c(b,c,d){d=JSON.parse(d.responseText),d.length?i(a,d):(bc.showMessage("No branches available!"),$("#modal-generic").modal("hide"))}function d(a,b,c){alert("Roh-roh. Something went wrong. :(")}function e(a,b){}var f={type:"POST",dataType:"json",data:"repo="+a,url:"/github/repo/fetch_branches",beforeSend:b,error:d,success:c,complete:e};$.ajax(f)},fetchTreeFiles:function(a,b){function c(b,c){bc.showMessage("Fetching Tree for Repo "+a)}function d(b,c,d){d=JSON.parse(d.responseText),d.tree.length?j(a,d.tree):(bc.showMessage("No tree files available!"),$("#modal-generic").modal("hide"))}function e(a,b,c){alert("Roh-roh. Something went wrong. :(")}function f(a,b){}var g={type:"POST",dataType:"json",data:"repo="+a+"&sha="+b,url:"/github/repo/fetch_tree_files",beforeSend:c,error:e,success:d,complete:f};$.ajax(g)},fetchMarkdownFile:function(a){function b(a,b){}function d(a,b,d){d=JSON.parse(d.responseText),d.error?(bc.showMessage("No markdown for you!"),$("#modal-generic").modal("hide")):($("#modal-generic").modal("hide"),c.getSession().setValue(d.data),Q())}function e(a,b,c){alert("Roh-roh. Something went wrong. :(")}function f(a,b){}var g={type:"POST",dataType:"json",data:"mdFile="+a,url:"/github/repo/fetch_markdown_file",beforeSend:b,error:e,success:d,complete:f};$.ajax(g)}}}(),be=function(){function d(c,d){return a=c.path.toLowerCase(),b=d.path.toLowerCase(),a===b?0:isNaN(c)||isNaN(d)?a>b?1:-1:c-d}function e(a){var b="<ul>";return a.sort(d),a.forEach(function(a){b+='<li data-file-path="'+a.path+'"><a class="dropbox_file" href="#">'+a.path+"</a></li>"}),b+="</ul>",$(".modal-header h3").text("Your Dropbox Files"),$(".modal-body").html(b),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}return{fetchAccountInfo:function(){function a(a,b){bc.showMessage("Fetching User Info from Dropbox")}function b(a,b,c){var d=JSON.parse(c.responseText);console.log("\nFetch User Info..."),bc.showMessage("Sup "+d.display_name)}function c(a,b,c){alert("Roh-roh. Something went wrong. :(")}function d(a,b){}var e={type:"GET",dataType:"json",url:"/dropbox/account/info",beforeSend:a,error:c,success:b,complete:d};$.ajax(e)},fetchMetadata:function(){function a(a,b){bc.showMessage("Fetching Metadata")}function b(a,b,c){var d=JSON.parse(c.responseText);console.dir(d)}function c(a,b,c){alert("Roh-roh. Something went wrong. :(")}function d(a,b){}var e={type:"GET",dataType:"json",url:"/dropbox/metadata",beforeSend:a,error:c,success:b,complete:d};$.ajax(e)},searchDropbox:function(){function a(a,b){bc.showMessage("Searching for .md Files")}function b(a,b,c){var d=JSON.parse(c.responseText);if(d.hasOwnProperty("statusCode")&&d.statusCode===401){var b=JSON.parse(d.data);bc.showMessage("Error! "+b.error,1e3),setTimeout(function(){bc.showMessage("Reloading!"),window.location.reload()},1250);return}d.length?e(d):bc.showMessage("No .md files found!")}function c(a,b,c){alert("Roh-roh. Something went wrong. :(")}function d(a,b){}var f={type:"GET",dataType:"json",url:"/dropbox/search",beforeSend:a,error:c,success:b,complete:d};$.ajax(f)},fetchMarkdownFile:function(a){function b(a,b){}function d(a,b,d){d=JSON.parse(d.responseText);if(d.statusCode===404){var e=JSON.parse(d.data);bc.showMessage(e.error)}else $("#modal-generic").modal("hide"),c.getSession().setValue(d.data),Q()}function e(a,b,c){alert("Roh-roh. Something went wrong. :(")}function f(a,b){}var g={type:"POST",dataType:"json",data:"mdFile="+a,url:"/dropbox/files/get",beforeSend:b,error:e,success:d,complete:f};$.ajax(g)},putMarkdownFile:function(){function a(a,b){}function b(a,b,c){c=JSON.parse(c.responseText);if(c.statusCode>=204){var d=JSON.parse(c.data);bc.showMessage(d.error,5e3)}else $("#modal-generic").modal("hide"),bc.showMessage(bc.messages.docSavedDropbox)}function d(a,b,c){alert("Roh-roh. Something went wrong. :(")}function e(a,b){}var f=encodeURIComponent(c.getSession().getValue()),g="pathToMdFile="+j.dropbox.current_filename+"&fileContents="+f,h={type:"POST",dataType:"json",data:g,url:"/dropbox/files/put",beforeSend:a,error:d,success:b,complete:e};$.ajax(h)}}}();G()}),window.onload=function(){var a=$("#loading");a.bind($.support.transitionEnd,function(b){$("#main").removeClass("bye"),a.remove()}).addClass("fade_slow")}